<script>
    // --- COMMON CHART OPTIONS ---
    const commonOptions = {
        responsive: true,
        maintainAspectRatio: false,
        indexAxis: 'y', // This makes the bars horizontal
        plugins: {
            tooltip: {
                backgroundColor: 'rgba(11, 17, 32, 0.95)',
                titleFont: { family: 'JetBrains Mono', size: 13 },
                bodyFont: { family: 'Inter', size: 12 },
                padding: 12,
                cornerRadius: 4,
                callbacks: {
                    // Custom Tooltip to explain the specific phase
                    title: function (context) {
                        return context[0].dataset.label;
                    },
                    label: function (context) {
                        return " Duration: " + context.raw + " Weeks";
                    }
                }
            },
            legend: { display: false } // We hide the default legend for a cleaner look
        },
        scales: {
            x: {
                stacked: true, // This stacks the time blocks
                title: { display: true, text: 'Weeks Until "Go Live"', font: { family: 'JetBrains Mono', size: 10 }, color: '#94A3B8' },
                grid: { color: '#F1F5F9' },
                min: 0,
                max: 12
            },
            y: {
                stacked: true,
                grid: { display: false },
                ticks: {
                    font: { family: 'JetBrains Mono', weight: '700', size: 12 },
                    color: '#0F172A'
                }
            }
        }
    };

    // --- CHART 1: TIMELINE REALITY (FIXED) ---
    const ctxTimeline = document.getElementById('timelineChart').getContext('2d');

    new Chart(ctxTimeline, {
        type: 'bar',
        data: {
            labels: ["Option A: Standard", "Option B: Sovereign"],
            datasets: [
                // SEGMENT 1: ADMIN & LEGAL
                {
                    label: 'Phase 1: Paperwork / NSA Approval',
                    data: [2, 4], // Option A: 2 weeks, Option B: 4 weeks
                    backgroundColor: [
                        '#3B82F6', // Blue (A)
                        '#EA580C'  // Dark Orange (B)
                    ],
                    barPercentage: 0.6,
                    borderRadius: 4
                },
                // SEGMENT 2: TECHNICAL SETUP
                {
                    label: 'Phase 2: Hardware & Keys',
                    data: [0, 4], // Option A: 0, Option B: 4 weeks
                    backgroundColor: [
                        '#3B82F6',
                        '#F97316'  // Orange
                    ],
                    barPercentage: 0.6,
                    borderRadius: 4,
                    borderSkipped: false
                },
                // SEGMENT 3: FINAL TRANSFER
                {
                    label: 'Phase 3: Funding & Transfer',
                    data: [0, 2], // Option A: 0, Option B: 2 weeks
                    backgroundColor: [
                        '#3B82F6',
                        '#FDBA74'  // Light Orange
                    ],
                    barPercentage: 0.6,
                    borderRadius: 4,
                    borderSkipped: false
                }
            ]
        },
        options: commonOptions
    });

    // --- CHART 2: LIQUIDITY PENALTY (Unchanged) ---
    const ctxPenalty = document.getElementById('penaltyChart').getContext('2d');

    new Chart(ctxPenalty, {
        type: 'bar',
        data: {
            labels: ['Gross Profit', 'Taxes & Penalty', 'You Keep'],
            datasets: [{
                label: 'Amount ($)',
                data: [40000, 18800, 21200],
                backgroundColor: [
                    '#E2E8F0', // Gray
                    '#EF4444', // Red
                    '#10B981'  // Green
                ],
                borderRadius: 4,
                barThickness: 50
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: { color: '#F1F5F9' },
                    ticks: { font: { family: 'JetBrains Mono' } }
                },
                x: {
                    grid: { display: false },
                    ticks: { font: { family: 'Inter', weight: 'bold' } }
                }
            }
        }
    });
</script>